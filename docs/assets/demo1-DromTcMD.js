import{u as V,T as B,a as r,V as i,v as o,s as ne,e as q,b as L,c as Z,d as ae,N as oe,f as se,g as re,m as ue,l as ot,h as st,i as rt,p as ut,j as it,P as ct,W as lt,S as dt,O as mt,M as ft,k as pt,R as _,F as vt,H as yt,n as xt,o as St,q as gt,r as ht,t as wt,w as Rt,x as Tt}from"./PointerManager-KrakMMpT.js";/* empty css              */const Dt=()=>{const e=V(new B),t=V(new B),n=r(new i),c=r(new i),a=r(new i),s=r(new i),g=r(0),f=r(1),h=r(.5),P=r(0),w=r(0),H=r(1),N=r(1),W=o(ne.xy).mul(c),u=o(W.x,W.y.oneMinus()),Q=$e=>{const et=o($e).mul(s),tt=ue(s.x.div(a.x),s.y.div(a.y)),fe=o(a).mul(tt),nt=o(s).sub(fe).mul(.5),at=o(et).sub(nt).div(fe);return t.sample(at).rgb},z=e.sample(u).r,O=f,j=f.mul(5),k=f.mul(10),Ce=e.sample(u.sub(o(n.x.mul(O),0))).r,Ge=e.sample(u.add(o(n.x.mul(O),0))).r,Fe=e.sample(u.sub(o(0,n.y.mul(O)))).r,Ae=e.sample(u.add(o(0,n.y.mul(O)))).r,Ie=o(Ge.sub(Ce).mul(.5),Ae.sub(Fe).mul(.5)),Ve=e.sample(u.sub(o(n.x.mul(j),0))).r,Be=e.sample(u.add(o(n.x.mul(j),0))).r,He=e.sample(u.sub(o(0,n.y.mul(j)))).r,Ne=e.sample(u.add(o(0,n.y.mul(j)))).r,We=o(Be.sub(Ve).mul(.5),Ne.sub(He).mul(.5)),Oe=e.sample(u.sub(o(n.x.mul(k),0))).r,je=e.sample(u.add(o(n.x.mul(k),0))).r,ke=e.sample(u.sub(o(0,n.y.mul(k)))).r,qe=e.sample(u.add(o(0,n.y.mul(k)))).r,Le=o(je.sub(Oe).mul(.5),qe.sub(ke).mul(.5)),le=q(h.mul(-1)),de=q(h.mul(-2)),Ee=le.add(de).add(1),Ke=Ie.mul(1).add(We.mul(le)).add(Le.mul(de)).div(Ee),Ue=u.add(Ke.mul(g)),Je=Q(Ue).toVar(),me=q(P.mul(z).mul(-1)),_e=L(1).mul(w.mul(L(1).sub(me))),Qe=Z(z.mul(N),0,1),Xe=L(Qe).mul(H),Ye=Z(Je.add(Xe),0,1).mul(me).add(_e),Ze=ae(Ye,1),X=new oe;return X.vertexNode=se(),X.fragmentNode=Ze,re(X,{uDye:e,uBackground:t,uDyeTexel:n,uScreenTexel:c,uBGSizePx:a,uScreenSizePx:s,uRefractAmp:g,uRefractRadius:f,uRefractFalloff:h,uDensityK:P,uSmokeGain:w,uOverlayStrength:H,uOverlayGain:N})},bt=()=>{const e=V(new B),t=V(new B),n=r(new i),c=r(new i),a=r(0),s=r(0),g=r(0),f=o(ne.xy).mul(c),h=e.sample(f).toVar(),P=a.mul(ot(h.xy)),w=st(.02,.1,P),H=f.sub(h.xy.mul(s).mul(a).mul(n).mul(w)),N=rt(H,c),W=t.sample(N).rgb,u=ut(.5,a.div(ue(g,1e-6))),Q=ae(W.mul(u),1),z=new oe;return z.vertexNode=se(),z.fragmentNode=Q,re(z,{uData:e,uImage:t,uTexelSize:n,uTextureSize:c,uDeltaT:a,uDyeAdvectScale:s,uHalfLife:g})},Pt=()=>{const e=V(new B),t=r(new i),n=r(new i),c=r(0),a=r(0),s=o(ne.xy).mul(t),g=e.sample(s).rgb.toVar(),f=s.sub(n).div(ue(o(c).mul(t),o(1e-6))),h=Z(g.add(L(1).mul(a).mul(q(it(f,f).mul(-1)))),0,1),P=ae(h,1),w=new oe;return w.vertexNode=se(),w.fragmentNode=P,re(w,{uImage:e,uTextureSize:t,uForceCenter:n,uForceRadius:c,uInjectGain:a})},x={pixelRatio:.5,solverIteration:2,forceRadius:40,forceCoefficient:500,dissipation:.999,pointerSpringK:.05,pointerSpringC:5,pointerSpringVisualGain:1e3};let pe=0;const p=new ct,l=new i(-1,-1),E=new i(-1,-1);let T=!1;const G=new i(-1,-1),v=new i(0,0),zt=.3,Mt=2;let D=0,K=0,$=0,ee=0,U=0,Y=!1;const ie=new i(-1,-1);let M=0,R=0;const S=new i,F=new i;let y,C,b,I;const d=new lt({antialias:!0});await d.init();d.setPixelRatio(devicePixelRatio);d.setSize(innerWidth,innerHeight);document.body.appendChild(d.domElement);const ve=new dt,Ct=new mt(-1,1,1,-1,0,1),ye=new ft(new pt(2,2));ve.add(ye);const xe={type:vt};y=new _(M,R,xe);C=new _(M,R,xe);Me(y);Me(C);const Se={type:yt};b=new _(innerWidth,innerHeight,Se);I=new _(innerWidth,innerHeight,Se);const ge=xt(),he=St(),we=gt(),Re=ht(),Te=wt(),De=Pt(),te=bt(),m=Dt();m.uniforms.uRefractAmp.value=1.6;m.uniforms.uRefractRadius.value=2;m.uniforms.uRefractFalloff.value=.6;m.uniforms.uDensityK.value=.5;m.uniforms.uSmokeGain.value=.7;m.uniforms.uOverlayStrength.value=1.1;m.uniforms.uOverlayGain.value=1.4;const Gt=new Rt,J=await Gt.loadAsync("texture_demo1.avif");m.uniforms.uBGSizePx.value.set(J.width,J.height);J.colorSpace=Tt;m.uniforms.uBackground.value=J;addEventListener("resize",be);p.init(d.domElement);p.addEventListener("firstInteraction",()=>{document.querySelector("#overlay-hint").style.display="none"});be();function be(){d.setPixelRatio(devicePixelRatio),d.setSize(innerWidth,innerHeight);const e=innerWidth*devicePixelRatio,t=innerHeight*devicePixelRatio;M=Math.round(e*x.pixelRatio),R=Math.round(t*x.pixelRatio),y.setSize(M,R),C.setSize(M,R),b.setSize(e,t),I.setSize(e,t),p.resizeTarget(x.pixelRatio,R),S.set(1/M,1/R),F.set(1/e,1/t),ge.uniforms.uTexelSize.value.copy(S),he.uniforms.uTexelSize.value.copy(S),we.uniforms.uTexelSize.value.copy(S),Re.uniforms.uTexelSize.value.copy(S),Te.uniforms.uTexelSize.value.copy(S),De.uniforms.uTextureSize.value.copy(F),te.uniforms.uTexelSize.value.copy(S),te.uniforms.uTextureSize.value.copy(F),m.uniforms.uDyeTexel.value.copy(F),m.uniforms.uScreenTexel.value.copy(F),m.uniforms.uScreenSizePx.value.set(e,t)}function Ft(e){return 1-Math.pow(1-e,3)}function At(e){if(U<=0)return;const t=Math.min(Math.max((e-ee)/U,0),1),n=Ft(t);D=K+($-K)*n}function It(e){if(p.isPointerDown&&(T||(G.copy(p.pointer),l.copy(G),E.copy(l),v.set(0,0),T=!0),G.copy(p.pointer)),T){const t=x.pointerSpringK,n=x.pointerSpringC,c=x.pointerSpringVisualGain,a=Math.min(Math.max(e,0),.032),s=G.clone().sub(l),g=t*s.x-n*v.x,f=t*s.y-n*v.y;v.x+=g*a,v.y+=f*a,l.x+=v.x*a*c,l.y+=v.y*a*c,s.lengthSq()<.5*.5&&v.lengthSq()<.5*.5&&(l.copy(G),v.set(0,0)),ie.copy(l),!p.isPointerDown&&D<=.001&&v.lengthSq()<1e-4&&(T=!1,l.set(-1,-1),E.set(-1,-1),v.set(0,0))}}function A(e){ce(e,C),Ot()}function Pe(e){ce(e,I),[b,I]=[I,b]}function Vt(){if(!T)return;const e=ge,t=e.uniforms,n=l.clone().sub(E).multiply(S).multiplyScalar(x.forceCoefficient).multiplyScalar(devicePixelRatio);t.uData.value=y.texture,t.uForceCenter.value.copy(l.clone().multiply(S)),t.uForceDeltaV.value.copy(n),t.uForceRadius.value=x.forceRadius*Math.max(D,0),A(e)}function Bt(e){const t=Math.min(Math.max(Math.floor(e*240),1),8);for(let n=0;n<t;n++){const c=e/t;{const a=he,s=a.uniforms;s.uData.value=y.texture,s.uDeltaT.value=c,s.uDissipation.value=x.dissipation,A(a)}{const a=we;a.uniforms.uData.value=y.texture,A(a)}for(let a=0;a<x.solverIteration;a++){const s=Re;s.uniforms.uData.value=y.texture,A(s)}{const a=Te;a.uniforms.uData.value=y.texture,A(a)}}}function Ht(){const e=De,t=e.uniforms;t.uImage.value=b.texture;const n=(T?l:ie).clone().multiply(S);t.uForceCenter.value.copy(n),t.uForceRadius.value=x.forceRadius*devicePixelRatio*Math.max(D,0),t.uInjectGain.value=50,Pe(e)}function Nt(e){const t=te,n=t.uniforms;n.uImage.value=b.texture,n.uData.value=y.texture,n.uDeltaT.value=e,n.uDyeAdvectScale.value=10,n.uHalfLife.value=.15,Pe(t)}function Wt(){const e=m,t=e.uniforms;t.uDye.value=b.texture,t.uRefractAmp.value=1.6,t.uRefractRadius.value=2,t.uRefractFalloff.value=.6,t.uDensityK.value=.5,t.uSmokeGain.value=.7,t.uOverlayStrength.value=1.1,t.uOverlayGain.value=1.4,ce(e,null)}ze(performance.now());function ze(e){const t=(e-pe)/1e3,n=e*.001;p.isPointerDown&&!Y?(K=D,$=1,ee=n,U=zt):!p.isPointerDown&&Y&&(K=D,$=0,ee=n,U=Mt,ie.copy(l)),It(t),At(n),Vt(),Bt(t),(p.isPointerDown||D>.001)&&Ht(),Nt(t),Wt(),p.updatePreviousPointer(),T&&E.copy(l),pe=e,Y=p.isPointerDown,requestAnimationFrame(ze)}function Me(e){d.setRenderTarget(e),d.clearColor(),d.setRenderTarget(null)}function ce(e,t){ye.material=e,d.setRenderTarget(t),d.render(ve,Ct),d.setRenderTarget(null)}function Ot(){[y,C]=[C,y]}
